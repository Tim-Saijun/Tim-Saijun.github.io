{"title":"单配置多主题博客方案","uid":"6e6b30b0bd6d414033ab3567b4a4ecfb","slug":"单配置多主题博客方案","date":"2023-09-09T08:52:47.000Z","updated":"2024-02-22T03:52:13.949Z","comments":true,"path":"api/articles/单配置多主题博客方案.json","keywords":"计算机技术,大数据,人工智能","cover":"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzNjAwOTd8MHwxfHNlYXJjaHwxMnx8d2VifGVufDB8fHx8MTY5NDI0OTY4NHww&ixlib=rb-4.0.3&q=80&w=400","content":"<h1 id=\"起因\"><a href=\"#起因\" class=\"headerlink\" title=\"起因\"></a>起因</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>很少有主题能兼顾实用与美观，比如极光主题虽然炫酷好看，但是单页展示的内容过少，不能专注于内容；<del>就是想折腾</del></p></blockquote>\n<p>因而产生了如下需求：</p>\n<ul>\n<li>一份配置文件生成多种主题的博客，同时存在</li>\n<li>站点间路由一致，方便随时切换<br>由于现在的博客全站是基于Git管理的，虽然可以使用不同的分支管理不同的主题，但这么做在每次更新文章的时候非常不方便，所以这种方案不采用。</li>\n</ul>\n<span id=\"more\"></span>\n<h1 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h1><p>由于<code>hexo generate</code>可以指定配置文件，这就为本方案提供了可能。<br>本次使用的是Hexo Next 8 和 Aurora 两套主题，配置文件在根目录的组织形式如下：</p>\n<div class=\"language-txt\"><button title=\"Copy code\" class=\"copy\" onclick=\"copyCode(this)\"></button><span class=\"lang\">txt</span><pre class=\"shiki dracula\" style=\"background-color: #282A36\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">-/</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">--_config.yml  为Aurora准备的全局配置</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">--_configsimple.yml  为Next准备的全局配置</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">--_config.aurora.yml  Aurora主题配置</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">--_config.next.yml  Next主题配置</span></span></code></pre></div><p>对于一般的主题，使用<code>hexo generate --config x.yml</code>也就没什么问题了，但是Aurora主题需要的插件<code>hexo-plugin-aurora</code>直接是对hexo命令生效的，也就是Aurora主题与其它主题互斥，有它在的情况下，就别想用别的主题，难道就没办法了吗？<br>由于不了解npm，我想到的笨办法是直接把<code>hexo-plugin-aurora</code>卸了，在构建需要时再装回来，这样就能保持<code>package.json</code>是干净的。<br>捋一下，现在为了两套主题，我们要做的：</p>\n<ul>\n<li>维护好各自独有的依赖</li>\n<li>使用自定义的生成命令</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>主题</th>\n<th>安装阶段</th>\n<th>生成阶段</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Aurora</td>\n<td><code>npm install hexo-plugin-aurora</code></td>\n<td><code>hexo generate --config _config.yml </code></td>\n</tr>\n<tr>\n<td>Next 8</td>\n<td>无额外依赖</td>\n<td><code>hexo generate --config _configsimple.yml</code></td>\n</tr>\n</tbody></table>\n<h1 id=\"路由问题\"><a href=\"#路由问题\" class=\"headerlink\" title=\"路由问题\"></a>路由问题</h1><p>统一多个站点的路由，比如我现在在<a href=\"http://www.zair.top/post/a\">www.zair.top/post/a</a> 页面里面，想要切换到另一个主题，只需要把www替换成s即可，即s.zair.top&#x2F;post&#x2F;a ，从而实现快速切换主题。</p>\n<p>这里的问题主要在地址的.html后缀上，一般来说，确保多个主题的全局配置文件中的以下字段统一即可：</p>\n<div class=\"language-yml\"><button title=\"Copy code\" class=\"copy\" onclick=\"copyCode(this)\"></button><span class=\"lang\">yml</span><pre class=\"shiki dracula\" style=\"background-color: #282A36\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #6272A4\"># permalink: :year/:month/:day/:title/ 配置详见https://hexo.io/zh-cn/docs/permalinks.html</span></span>\n<span class=\"line\"><span style=\"color: #8BE9FD\">permalink</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">/post/:title.html</span></span>\n<span class=\"line\"><span style=\"color: #8BE9FD\">permalink_defaults</span><span style=\"color: #FF79C6\">:</span></span>\n<span class=\"line\"><span style=\"color: #8BE9FD\">pretty_urls</span><span style=\"color: #FF79C6\">:</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">  </span><span style=\"color: #8BE9FD\">trailing_index</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #BD93F9\">true</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #6272A4\"># Set to false to remove trailing &#39;index.html&#39; from permalinks</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">  </span><span style=\"color: #8BE9FD\">trailing_html</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #BD93F9\">true</span><span style=\"color: #F8F8F2\">  # </span><span style=\"color: #F1FA8C\">Set to false to remove trailing &#39;.html&#39; from permalinks</span></span></code></pre></div><p>但Aurora哪是一般的主题，它是由Vue构建的单页应用，地址栏输入的后缀（如&#x2F;post&#x2F;a）统统按请求参数处理，而一般的主题则认为它是一个静态页面的路径。如果托关于Cloudflare Pages上，这个问题可以忽略，但Vercel的需要自己配置，具体来说，需要在根目录创建<code>vercel.json</code>，内容如下：</p>\n<div class=\"language-json\"><button title=\"Copy code\" class=\"copy\" onclick=\"copyCode(this)\"></button><span class=\"lang\">json</span><pre class=\"shiki dracula\" style=\"background-color: #282A36\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">redirects</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> [</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        &#123; </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">source</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/post/:path*.html</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">, </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">destination</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/post/:path*</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\"> &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    ],</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">rewrites</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> [</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        &#123; </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">source</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/:path*</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">, </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">destination</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/index.html</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\"> &#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    ]</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span></code></pre></div><p>第一条将所有的.html后缀重定向，这是为了兼容一般静态主题；<br>第二条将所有请求反向代理到根页面，是Aurora在Vercel上需要配置的；<br>两条规则其实是冲突的，但冲突时，Vercel选择靠前的遵守，用起来没问题。</p>\n<p>对于许多静态页面托管网站，都有Pretty URL的功能，将URL的.html后缀去掉，但Vercel叒没有，如果想用，得配置另一个<code>vercel.json</code>:</p>\n<div class=\"language-json\"><button title=\"Copy code\" class=\"copy\" onclick=\"copyCode(this)\"></button><span class=\"lang\">json</span><pre class=\"shiki dracula\" style=\"background-color: #282A36\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F8F8F2\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">rewrites</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> [</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">        &#123; </span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">source</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/:path*</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">,</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #8BE9FD\">destination</span><span style=\"color: #8BE9FE\">&quot;</span><span style=\"color: #FF79C6\">:</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F1FA8C\">/:path*.html</span><span style=\"color: #E9F284\">&quot;</span><span style=\"color: #F8F8F2\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">    ]</span></span>\n<span class=\"line\"><span style=\"color: #F8F8F2\">&#125;</span></span></code></pre></div><p>但是，Vercel的配置文件不支持重命名，只能有一个，所以Next主题的网站就只能托管于Netlify，Netlify对.html后缀就处理得很好。<br>最后再分享一下在两个网站得部署配置：<br><img src=\"https://cdn.saijun.eu.org/pic/2023/09/0b7fb307bea391b2e17d21a94314544b.png\" alt=\"image.png\"><br>这是在Vercel上部署Aurora的配置，其实是两条命令</p>\n<div class=\"language-bash\"><button title=\"Copy code\" class=\"copy\" onclick=\"copyCode(this)\"></button><span class=\"lang\">bash</span><pre class=\"shiki dracula\" style=\"background-color: #282A36\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #50FA7B\">npm</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">install</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">hexo-plugin-aurora</span><span style=\"color: #F8F8F2\"> &amp;&amp; </span><span style=\"color: #50FA7B\">cp</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">index_prod-00ee5e98.js</span><span style=\"color: #F8F8F2\"> </span><span style=\"color: #F1FA8C\">node_modules/hexo-theme-aurora/source/static/js/</span></span></code></pre></div><p>第二条是用来覆盖我自定义的主题js；</p>\n<p>下图是在Netlify上的配置：<br><img src=\"https://cdn.saijun.eu.org/pic/2023/09/42e78625e505e51a195089a0752bd993.png\" alt=\"image.png\"></p>\n","text":"起因 很少有主题能兼顾实用与美观，比如极光主题虽然炫酷好看，但是单页展示的内容过少，不能专注于内容；就是想折腾 因而产生了如下需求： 一份配置文件生成多种主题的...","link":"","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"技术帖子","slug":"技术帖子","count":4,"path":"api/categories/技术帖子.json"}],"tags":[{"name":"Vercel","slug":"Vercel","count":1,"path":"api/tags/Vercel.json"},{"name":"Netlify","slug":"Netlify","count":1,"path":"api/tags/Netlify.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%B5%B7%E5%9B%A0\"><span class=\"toc-text\">起因</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">配置</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%B7%AF%E7%94%B1%E9%97%AE%E9%A2%98\"><span class=\"toc-text\">路由问题</span></a></li></ol>","author":{"name":"以太工坊","slug":"blog-author","avatar":"/img/logo.png","link":"/","description":"分享我的课程学习笔记、经验与有趣的小玩意.图片等资源无法加载时请使用代理","socials":{"github":"https://github.com/Tim-Saijun","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"telegram":{"icon":"/img/telegram.svg","link":"https://t.me/tim_run"},"Email":{"icon":"/img/mail.svg","link":"mailto:b@zair.top"},"RSS":{"icon":"/img/rss.svg","link":"/atom.xml"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"保研经验帖","uid":"60101ff7c958535a3d3adf3b1d35269f","slug":"baoyan","date":"2023-10-09T09:55:45.000Z","updated":"2024-02-22T03:52:13.945Z","comments":true,"path":"api/articles/baoyan.json","keywords":"计算机技术,大数据,人工智能","cover":"https://images.unsplash.com/20/cambridge.JPG?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzNjAwOTd8MHwxfHNlYXJjaHwyfHx1bml2ZXJzaXR5fGVufDB8fHx8MTY5Njg0NTQ1M3ww&ixlib=rb-4.0.3&q=80&w=400","text":"基本情况末流211计算机学院大数据专业，排名（2&#x2F;99），CET6 (553)，三段项目经历，无paper，一些水奖； 夏令营夏令营基本情况可见下图：...","link":"","photos":[],"count_time":{"symbolsCount":"5.5k","symbolsTime":"5 mins."},"categories":[{"name":"others","slug":"others","count":3,"path":"api/categories/others.json"}],"tags":[{"name":"保研","slug":"保研","count":2,"path":"api/tags/保研.json"}],"author":{"name":"以太工坊","slug":"blog-author","avatar":"/img/logo.png","link":"/","description":"分享我的课程学习笔记、经验与有趣的小玩意.图片等资源无法加载时请使用代理","socials":{"github":"https://github.com/Tim-Saijun","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"telegram":{"icon":"/img/telegram.svg","link":"https://t.me/tim_run"},"Email":{"icon":"/img/mail.svg","link":"mailto:b@zair.top"},"RSS":{"icon":"/img/rss.svg","link":"/atom.xml"}}}},"feature":true},"next_post":{"title":"首页导航","uid":"319b8234c5d2a285f0f89f7f3059426e","slug":"home","date":"2023-09-08T13:13:52.000Z","updated":"2024-02-22T03:52:13.945Z","comments":true,"path":"api/articles/home.json","keywords":"计算机技术,大数据,人工智能","cover":"https://images.unsplash.com/photo-1518065896235-a4c93e088e7a?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wzNjAwOTd8MHwxfHNlYXJjaHwyfHxjb21wYXNzfGVufDB8fHx8MTY5NDE2NDUwMHww&ixlib=rb-4.0.3&q=80&w=400","text":"你好，欢迎来到以太工坊！👋 如果您使用笔记本电脑，或是希望专注与内容，推荐访问极简版s.zair.top如果您使用24寸及以上的高分屏，或是希望体验更多功能，推...","link":"","photos":[],"count_time":{"symbolsCount":282,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"以太工坊","slug":"blog-author","avatar":"/img/logo.png","link":"/","description":"分享我的课程学习笔记、经验与有趣的小玩意.图片等资源无法加载时请使用代理","socials":{"github":"https://github.com/Tim-Saijun","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"telegram":{"icon":"/img/telegram.svg","link":"https://t.me/tim_run"},"Email":{"icon":"/img/mail.svg","link":"mailto:b@zair.top"},"RSS":{"icon":"/img/rss.svg","link":"/atom.xml"}}}}}}